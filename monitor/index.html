<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stress Test Monitor</title>
    <style>
        body {
            font-family: sans-serif;
            background: #f5f5f5;
            display: flex;
            gap: 20px;
            padding: 20px;
        }
        .panel {
            flex: 1;
            background: #fff;
            border: 1px solid #ccc;
            padding: 10px;
            height: 90vh;
            overflow-y: auto;
        }
        .asterisk { border-left: 5px solid #007BFF; }
        .freeswitch { border-left: 5px solid #28A745; }
        .entry { margin-bottom: 8px; }
        .explosion { color: red; font-weight: bold; }
        .winner { color: green; font-weight: bold; }
    </style>
</head>
<body>

<div class="panel asterisk">
    <h2>Asterisk</h2>
    <div id="asterisk-log"></div>
</div>

<div class="panel freeswitch">
    <h2>FreeSWITCH</h2>
    <div id="freeswitch-log"></div>
</div>

<script>
    // Establish WebSocket connection to backend server
    const ws = new WebSocket("ws://" + location.hostname + ":8000/ws");

    ws.onmessage = (event) => {
        const msg = JSON.parse(event.data);
        const panelId = msg.data.test_type === "asterisk" ? "asterisk-log" : "freeswitch-log";
        const logDiv = document.getElementById(panelId);

        const div = document.createElement("div");
        div.classList.add("entry");

        // Step-by-step progress info
        if (msg.type === "progress") {
            div.innerText = `[STEP ${msg.data.step}] Calls: ${msg.data.calls}, CPU: ${msg.data.cpu}%, Memory: ${msg.data.memory}, BW TX: ${msg.data.bw_tx} kb/s, BW RX: ${msg.data.bw_rx} kb/s`;

        // Explosion event (when CPU threshold is exceeded)
        } else if (msg.type === "explosion") {
            div.classList.add("explosion");
            div.innerText = `üî• EXPLOSION! CPU ${msg.data.cpu}% at step ${msg.data.step}`;
        
        // Winner event (when the other system already exploded)
        } else if (msg.type === "winner") {
            div.classList.add("winner");
            div.innerText = `üèÜ WINNER! CPU ${msg.data.cpu}% at step ${msg.data.step}`;
        }

        logDiv.appendChild(div);
        logDiv.scrollTop = logDiv.scrollHeight; // Auto-scroll to bottom
    };

    ws.onerror = () => {
        alert("‚ùå WebSocket connection failed.");
    };
</script>

</body>
</html>
